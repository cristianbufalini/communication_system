<!DOCTYPE html>
<html>
<head>
    <title>Mensajes en Tiempo Real</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/dist/stomp.min.js"></script>
</head>
<body>
    <h1>Mensajes en Tiempo Real</h1>
    <ul id="mensajes-lista">
        {% for mensaje in mensajes %}
            <li>{{ mensaje.usuario.username }}: {{ mensaje.contenido }}</li>
        {% endfor %}
    </ul>

    <script>
        // Conectarse al servidor WebSocket de Django Channels
        const socket = new SockJS('/ws/chat/');
        const stompClient = Stomp.over(socket);

        stompClient.connect({}, function (frame) {
            // Suscribirse al canal de mensajes
            stompClient.subscribe('/chat_group/', function (mensaje) {
                // Recibir y procesar nuevos mensajes
                const mensajeData = JSON.parse(mensaje.body);
                const nuevoMensaje = `${mensajeData.usuario}: ${mensajeData.message}`;
                agregarMensajeAlLista(nuevoMensaje);
            });
        });

        function agregarMensajeAlLista(mensaje) {
            const mensajesLista = document.getElementById('mensajes-lista');
            const nuevoElemento = document.createElement('li');
            nuevoElemento.textContent = mensaje;
            mensajesLista.appendChild(nuevoElemento);
        }
    </script>
</body>
</html>
<!-- BotÃ³n para ir a la vista de chat -->
<a href="{% url 'chat' %}"><button>Enviar Mensaje</button></a>